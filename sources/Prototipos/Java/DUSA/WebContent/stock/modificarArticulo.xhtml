<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<f:view contentType="text/html">
	<h:head>
		<link href="../CSS/General.css" rel="stylesheet" />
		<link href="../CSS/bootstrap-theme.min.css" rel="stylesheet" />
		<link href="../CSS/font-awesome.min.css" rel="stylesheet" />
		<script src="../JS/bootstrap.min.js"></script>		
		<f:facet name="first">
			<meta content='text/html; charset=UTF-8' http-equiv="Content-Type" />
			<title>DUSA</title>
		</f:facet>
		<script src="../JS/altaArticulo.js"></script>
	</h:head>
	<h:body>
		<link href="../CSS/bootstrap.min.css" rel="stylesheet" />
		<h:form id="form1">
			<ui:include src="../cabezal.xhtml" />
			<ui:include src="../menuVertical/stock.xhtml" />
			#{loginBean.redirectIfNotLoggedIn()}
        	#{stockBean.setISistema(loginBean.instanciaSistema)}
			<div class="vpanel_right">
				<div class="wrapper">				
					<div class="panel panel-default" id="panel">
						<div class="panel-heading">
							<h3 class="panel-title">Modificación de artículo</h3>
						</div>
						<p:messages id="msgs" showIcon="false" globalOnly="true" />					
						<div class="panel-body">
							<h:panelGroup layout="block" id="panel">
							<div class="container-fluid">
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
										<p:outputLabel for="descripcion" value="Descripción:" />
										<p:inputText id="descripcion" styleClass="form-control" value="#{stockBean.articulo.descripcion}" size="60" requiredMessage="Dato Requerido." style="height: 100%"
										required="true" validatorMessage="El largo máximo permitido es de 25 caracteres." >
											<f:validateLength minimum="1" maximum="25" />
										</p:inputText>
										<p:message for="descripcion" display="text" />
									</div>									
									<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="codigoBarras" value="Código de barras:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:inputText id="codigoBarras" value="#{stockBean.articulo.codigoBarras}" styleClass="form-control" validatorMessage="El largo máximo permitido es de 25 caracteres." >
													<f:validateLength minimum="0" maximum="25" />
												</p:inputText>
												<p:message for="codigoBarras" display="text" />
											</div>
										</div>		
									</div>
								</div>
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="clave1" value="Clave de búsqueda 1:" />
												<span data-toggle="tooltip" title="Clave de largo 5 que se usa para optimizar las búsquedas" 
														class="glyphicon glyphicon-question-sign"></span>												
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:inputText id="clave1" value="#{stockBean.articulo.clave1}" styleClass="form-control" validatorMessage="El largo máximo permitido es de 5 caracteres." >
													<f:validateLength minimum="0" maximum="5" />
												</p:inputText>			
												<p:message for="clave1" display="text" />									
											</div>
										</div>		
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="clave2" value="Clave de búsqueda 2:" />
												<span data-toggle="tooltip" title="Clave de largo 2 que se usa para optimizar las búsquedas" 
														class="glyphicon glyphicon-question-sign"></span>
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:inputText id="clave2" value="#{stockBean.articulo.clave2}" styleClass="form-control" validatorMessage="El largo máximo permitido es de 2 caracteres." >
													<f:validateLength minimum="0" maximum="2" />
												</p:inputText>
												<p:message for="clave2" display="text" />
											</div>
										</div>		
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="clave3" value="Clave de búsqueda 3:" />
												<span data-toggle="tooltip" title="Clave de largo 2 que se usa para optimizar las búsquedas" 
														class="glyphicon glyphicon-question-sign"></span>
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:inputText id="clave3" value="#{stockBean.articulo.clave3}" styleClass="form-control" validatorMessage="El largo máximo permitido es de 2 caracteres." >
													<f:validateLength minimum="0" maximum="2" />
												</p:inputText>
												<p:message for="clave3" display="text" />
											</div>
										</div>		
									</div>
								</div>
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="tipoArticulo" value="Tipo de Artículo:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectOneMenu id="tipoArticulo" value="#{stockBean.articulo.tipoArticulo}" required="true" requiredMessage="Dato Requerido." >
										            <p:ajax listener="#{stockBean.tipoArticuloChange}" update="drogas accionesTer psicofarmaco estupefaciente formaVenta" />
										            <f:selectItem itemLabel="Seleccione tipo de artículo" itemValue="#{null}" noSelectionOption="true" />
										            <f:selectItems value="#{stockBean.tiposArticulo}" var="ta" itemLabel="#{ta.descripcion}" itemValue="#{ta.tipoArticulo}"/>
										        </p:selectOneMenu>
										        <p:message for="tipoArticulo" display="text" />
											</div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="marcaOLab" value="Marca/Laboratorio:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectOneMenu id="marcaOLab" value="#{stockBean.articulo.idMarca}"
										        			filter="true" filterMatchMode="contains" required="true" requiredMessage="Dato Requerido." >
										            <f:selectItem itemLabel="Seleccione marca o laboratorio" itemValue="#{null}" />
										            <f:selectItems value="#{stockBean.listaMarcas}" var="m" itemLabel="#{m.nombreComercial}" itemValue="#{m.idProveedor}"/>
										        </p:selectOneMenu>
										        <p:message for="marcaOLab" display="text" />
									        </div>
								        </div>
									</div>
								</div>
								<div class="panel panel-default">
									<div class="panel-heading">
										<h3 class="panel-title">Proveedores: *</h3>
									</div>
									<div class="panel-body">
										<div class="row" style="margin-bottom: 1%;">
											<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
												<div class="row">
													<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
														<p:outputLabel for="proveedor" value="Proveedor:" />
													</div>
												</div>
												<div class="row">
													<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
														<p:selectOneMenu id="proveedor" value="#{stockBean.proveedor}"
												        			filter="true" filterMatchMode="contains" required="false" >
												            <f:selectItem itemLabel="Seleccione proveedor" itemValue="#{null}" />
												            <f:selectItems value="#{stockBean.listaProveedores}" var="p" itemLabel="#{p.nombreComercial}" itemValue="#{p.idProveedor}"/>
												        	<f:ajax event="change" execute="@this" />
												        </p:selectOneMenu>
											        </div>
										        </div>
											</div>
											<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
												<div class="row">
													<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
														<p:outputLabel for="codigoIdentificador" value="Código identificador:" />
														<span data-toggle="tooltip" title="Código único del artículo para el proveedor seleccionado. Entre 1 y 2147483647." 
														class="glyphicon glyphicon-question-sign"></span>
													</div>
												</div>
												<div class="row">
													<div class="col-xs-10 col-sm-10 col-md-10 col-lg-10">
														<p:inputText id="codigoIdentificador" styleClass="form-control" value="#{stockBean.codigoIdentificador}" style="height: 100%"
														required="false" validatorMessage="Dato inválido." converterMessage="Dato inválido." >
															<f:validateDoubleRange minimum="0" maximum="2147483647" />
														</p:inputText>
														<p:message for="codigoIdentificador" display="text" />
													</div>
													<div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
														<p:commandButton value="Agregar" update="msgs codigoIdentificador proveedor tablaProveedores" validateClient="true" actionListener="#{stockBean.agregarProveedor}" 
														styleClass="btn btn-info pull-right" process="@this,codigoIdentificador"/>
													</div>
												</div>
											</div>
										</div>
										
										<div class="row" style="margin-bottom: 1%;">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:dataTable id="tablaProveedores" var="proveedor" value="#{stockBean.proveedoresSeleccionados}" emptyMessage="No hay ningún proveedor asociado a este artículo.">
												    <p:column headerText="Nombre comercial">
												        <h:outputText value="#{proveedor.nombreComercial}" />
												    </p:column>
												 
												    <p:column headerText="Código identificador">
												        <h:outputText value="#{proveedor.codigoIdentificador}" />
												    </p:column>
												 </p:dataTable>												 
											 </div>
										</div>
									</div>
								</div>
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<p:outputLabel for="presentacion" value="Presentacion:" />
										<p:inputText id="presentacion" value="#{stockBean.articulo.presentacion}" styleClass="form-control" 
										validatorMessage="El largo máximo permitido es de 60 caracteres." required="true" requiredMessage="Dato Requerido." >
											<f:validateLength minimum="1" maximum="60" />
										</p:inputText>
										<p:message for="presentacion" display="text" />
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
					       				<p:outputLabel for="drogas" value="Drogas:" />
					       				<p:selectManyMenu id="drogas" value="#{stockBean.articulo.drogas}" required="false" disabled="#{stockBean.noEsMedicamento}"
					                          filter="true" filterMatchMode="contains" showCheckbox="true" style="height: 100%; width: 100%">
								            <f:selectItems value="#{stockBean.listaDrogas}" var="droga" itemLabel="#{droga.descripcion}" itemValue="#{droga.idDroga}" />
							        	</p:selectManyMenu>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
						       			<p:outputLabel for="accionesTer" value="Acciones Terapéuticas:" />
						       			<p:selectManyMenu id="accionesTer" value="#{stockBean.articulo.accionesTer}" required="false" disabled="#{stockBean.noEsMedicamento}"
						                          filter="true" filterMatchMode="contains" showCheckbox="true" style="height: 100%; width: 100%">
								            <f:selectItems value="#{stockBean.listaAccionesTer}" var="accionTer" itemLabel="#{accionTer.descripcion}" itemValue="#{accionTer.idAccionTer}" />
								        </p:selectManyMenu>
									</div>
								</div>
								
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="psicofarmaco" value="Es psicofármaco:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectBooleanCheckbox id="psicofarmaco" value="#{stockBean.articulo.esPsicofarmaco}" disabled="#{stockBean.noEsMedicamento}" />
											</div>
										</div>							
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="estupefaciente" value="Es estupefaciente:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectBooleanCheckbox id="estupefaciente" value="#{stockBean.articulo.esEstupefaciente}" disabled="#{stockBean.noEsMedicamento}" />
											</div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="heladera" value="Es de heladera:" />												
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectBooleanCheckbox id="heladera" value="#{stockBean.articulo.esHeladera}" />												
										    </div>
										</div>
									</div>
								</div>
								
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<p:outputLabel for="costoLista" value="Costo de lista ($):" />
										<p:inputText id="costoLista" styleClass="form-control" value="#{stockBean.articulo.costoLista}" converterMessage="Dato Inválido." requiredMessage="Dato Requerido." style="height: 100%"
										required="true" >
						                	<f:convertNumber type="number" maxIntegerDigits="12" maxFractionDigits="2" locale="es_UY"/>
						            	</p:inputText>
						            	<p:message for="costoLista" display="text" />
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<p:outputLabel for="costoReal" value="Costo real ($):" />
										<p:inputText id="costoReal" styleClass="form-control" value="#{stockBean.articulo.ultimoCosto}" converterMessage="Dato Inválido." requiredMessage="Dato Requerido." style="height: 100%"
										required="true" >
						                	<f:convertNumber type="number"/>
						            	</p:inputText>
						            	<p:message for="costoReal" />
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<p:outputLabel for="costoOferta" value="Costo de oferta ($):" />
										<p:inputText id="costoOferta" styleClass="form-control" value="#{stockBean.articulo.costoOferta}" converterMessage="Dato Inválido." requiredMessage="Dato Requerido." style="height: 100%"
										required="true" >
						                	<f:convertNumber type="number" maxIntegerDigits="12" maxFractionDigits="2" locale="es_UY"/>
						            	</p:inputText>
						            	<p:message for="costoOferta" display="text" />
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<p:outputLabel for="costoPromedio" value="Costo promedio ($):" />
										<p:inputText id="costoPromedio" styleClass="form-control" value="#{stockBean.articulo.costoPromedio}" converterMessage="Dato Inválido." requiredMessage="Dato Requerido." style="height: 100%"
										required="true" >
						                	<f:convertNumber type="number" maxIntegerDigits="12" maxFractionDigits="2" locale="es_UY"/>
						            	</p:inputText>
						            	<p:message for="costoPromedio" display="text" />
									</div>
								</div>
								
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<p:outputLabel for="precioPublico" value="Precio público ($):" />
										<p:inputText id="precioPublico" styleClass="form-control" value="#{stockBean.articulo.precioUnitario}" converterMessage="Dato Inválido." requiredMessage="Dato Requerido." style="height: 100%"
										required="true" >
						                	<f:convertNumber type="number" maxIntegerDigits="12" maxFractionDigits="2" locale="es_UY"/>
						            	</p:inputText>
						            	<p:message for="precioPublico" display="text" />
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<p:outputLabel for="precioVenta" value="Precio de venta ($):" />
										<p:inputText id="precioVenta" styleClass="form-control" value="#{stockBean.articulo.precioVenta}" converterMessage="Dato Inválido." style="height: 100%" >
						                	<f:convertNumber type="number" maxIntegerDigits="12" maxFractionDigits="2" locale="es_UY"/>
						            	</p:inputText>
						            	<p:message for="precioVenta" display="text" />
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<p:outputLabel for="porcentajePrecioVenta" value="Precio de venta (%):" />
										<p:inputText id="porcentajePrecioVenta" styleClass="form-control" value="#{stockBean.articulo.porcentajePrecioVenta}" converterMessage="Dato Inválido." style="height: 100%" >
						                	<f:convertNumber type="percent" locale="es_UY"/>
						            	</p:inputText>
						            	<p:message for="porcentajePrecioVenta" display="text" />
									</div>
								</div>
								
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="formaVenta" value="Forma de venta:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectOneMenu id="formaVenta" value="#{stockBean.articulo.codigoVenta}" required="true" requiredMessage="Dato Requerido." disabled="#{stockBean.noEsMedicamento}" >
										            <f:selectItem itemLabel="Seleccione forma de venta" itemValue="#{null}" />
										            <f:selectItems value="#{stockBean.formasVenta}" var="f" itemLabel="#{f.descripcion}" itemValue="#{f.formaVenta}"/>
										        </p:selectOneMenu>
										        <p:message for="formaVenta" display="text" />
										    </div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="tipoIVA" value="Tipo de IVA:" />
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:selectOneMenu id="tipoIVA" value="#{stockBean.tipoIvaSeleccionado}" style="height: 100%" required="false" >
										            <f:selectItem itemLabel="Seleccione tipo de IVA" itemValue="#{null}" />
										            <f:selectItems value="#{stockBean.tiposIVA}" var="t" itemLabel="#{t.descripcion}" itemValue="#{t.tipoIVA}" />
										        </p:selectOneMenu>
										    </div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="stockMinimo" value="Stock Mínimo:" />
												<span data-toggle="tooltip" title="Número que indica el mínimo de stock requerido para el artículo." 
														class="glyphicon glyphicon-question-sign"></span>
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:inputText id="stockMinimo" styleClass="form-control" value="#{stockBean.articulo.stockMinimo}" converterMessage="Dato Inválido." >
								                	<f:convertNumber type="number"/>
								            	</p:inputText>
								            	<p:message for="stockMinimo" display="text" />
										    </div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:outputLabel for="fechaVencimiento" value="Fecha de Vencimiento:" />
												<span data-toggle="tooltip" title="Ingresar una fecha de vencimiento representativa de los artículos en stock." 
														class="glyphicon glyphicon-question-sign"></span>
											</div>
										</div>
										<div class="row">
											<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
												<p:calendar id="fechaVencimiento" value="#{stockBean.articulo.vencimientoMasCercano}" pattern="dd-MM-yyyy" mask="true" />
								            	<p:message for="fechaVencimiento" display="text" />
										    </div>
										</div>
									</div>
								</div>
	
								<div class="row" style="margin-bottom: 1%;">
									<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
										<div class="btn-group pull-right">									
											<h:commandButton value="Confirmar" update="panel msgs msgTabla" actionListener="#{stockBean.altaArticulo}" styleClass="btn btn-success" />
											<h:commandButton value="Cancelar"  update="panel" actionListener="#{stockBean.cancelarAltaArticulo}" styleClass="btn btn-default" immediate="true"/>
										</div>
									</div>								
								</div>
							</div>
							</h:panelGroup>
						</div>
					</div>
				</div>
			</div>
			<p:ajaxStatus
				style="width:64px;height:64px;position:fixed;right:5px;bottom:5px"
				id="ajaxStatusPanel0">
				<f:facet name="start">
					<h:graphicImage value="../Images/ajax_loading_big.gif" />
				</f:facet>

				<f:facet name="complete">
					<h:outputText value="" />
				</f:facet>
			</p:ajaxStatus>
		</h:form>
	</h:body>
</f:view>
</html>