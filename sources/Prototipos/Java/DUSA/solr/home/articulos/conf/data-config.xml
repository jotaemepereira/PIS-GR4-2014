<dataConfig>

	<dataSource type="JdbcDataSource" driver="org.postgresql.Driver"
		url="${postgres.url}" user="${postgres.user}" password="${postgres.pass}"
		readOnly="True" />

	<document name="productos">
		<entity name="stock"
			query="SELECT P.PRODUCT_ID AS id, P.PRODUCT_ID, P.DESCRIPTION, P.KEY1, P.KEY2, P.KEY3, P.BARCODE, P.KEY1 || P.KEY2 || P.KEY3 AS CRITERIO_INTERNO
				                       FROM PRODUCTS P 
				                       WHERE KEY1 != 'PRODU' AND SALE_PRICE > 0 AND STATUS = 't'"
			deltaImportQuery="SELECT PRODUCT_ID AS id, DESCRIPTION, KEY1, KEY2, KEY3, BARCODE, KEY1 || KEY2 || KEY3 AS CRITERIO_INTERNO 
					 					FROM PRODUCTS 
					 					WHERE PRODUCT_ID = '${dih.delta.id}'"
			deltaQuery="SELECT P.PRODUCT_ID AS id
				                       FROM PRODUCTS P 
				                       WHERE KEY1 != 'PRODU' AND SALE_PRICE > 0 AND STATUS = 't'
                           					AND LAST_MODIFIED >='${dih.last_index_time}'">

			<field column="id" name="id" />
			<field column="DESCRIPTION" name="DESCRIPTION" />
			<field column="KEY1" name="KEY1" />
			<field column="KEY2" name="KEY2" />
			<field column="KEY3" name="KEY3" />
			<field column="BARCODE" name="BARCODE" />
			<field column="CRITERIO_INTERNO" name="CRITERIO_INTERNO" />
			
			<entity name="drugs"
				query="SELECT D.DESCRIPTION AS DROGA 
							FROM PRODUCT_DRUGS PD 
							INNER JOIN DRUGS D ON D.DRUG_ID = PD.DRUG_ID
							WHERE PRODUCT_ID = '${stock.id}'">
					<field column="DROGA" name="DROGA" />
			</entity>

		</entity>

	</document>

</dataConfig>
