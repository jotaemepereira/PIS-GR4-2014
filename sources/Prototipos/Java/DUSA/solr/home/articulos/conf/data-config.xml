<dataConfig>

	<dataSource type="JdbcDataSource" driver="org.postgresql.Driver"
		url="${postgres.url}" user="${postgres.user}" password="${postgres.pass}"
		readOnly="True" />

	<document name="productos">
		<entity name="stock"
			query="SELECT P.PRODUCT_ID AS id, P.PRODUCT_ID, P.DESCRIPTION, P.KEY1, P.KEY2, P.KEY3, P.BARCODE, P.KEY1 || P.KEY2 || P.KEY3 AS CRITERIO_INTERNO, P.PRESENTATION, M.COMERCIALNAME AS MARCA
				                       FROM PRODUCTS P 
				                       LEFT JOIN SUPPLIERS M ON M.SUPPLIER_ID = P.BRAND_ID
				                       WHERE P.KEY1 != 'PRODU' AND P.SALE_PRICE > 0 AND P.STATUS = 't'"
			deltaImportQuery="SELECT P.PRODUCT_ID AS id, P.DESCRIPTION, P.KEY1, P.KEY2, P.KEY3, P.BARCODE, P.KEY1 || P.KEY2 || P.KEY3 AS CRITERIO_INTERNO, P.PRESENTATION, M.COMERCIALNAME AS MARCA
					 					FROM PRODUCTS P
					 					LEFT JOIN SUPPLIERS M ON M.SUPPLIER_ID = P.BRAND_ID
					 					WHERE PRODUCT_ID = '${dih.delta.id}'"
			deltaQuery="SELECT P.PRODUCT_ID AS id
				                       FROM PRODUCTS P 
				                       WHERE KEY1 != 'PRODU' AND SALE_PRICE > 0 AND STATUS = 't'
                           					AND LAST_MODIFIED >='${dih.last_index_time}'">

			<field column="id" name="id" />
			<field column="DESCRIPTION" name="DESCRIPTION" />
			<field column="KEY1" name="KEY1" />
			<field column="KEY2" name="KEY2" />
			<field column="KEY3" name="KEY3" />
			<field column="BARCODE" name="BARCODE" />
			<field column="CRITERIO_INTERNO" name="CRITERIO_INTERNO" />
			<field column="MARCA" name="MARCA" />
			<field column="PRESENTATION" name="PRESENTATION" />
			
			<entity name="drugs"
				query="SELECT D.DESCRIPTION AS DROGAS
							FROM PRODUCT_DRUGS PD 
							INNER JOIN DRUGS D ON D.DRUG_ID = PD.DRUG_ID
							WHERE PD.PRODUCT_ID = '${stock.id}'">
					<field column="DROGAS" name="DROGAS" />
			</entity>
			
			<entity name="acciones_terapeuticas"
				query="SELECT D.DESCRIPTION AS ACCIONES_TERAPEUTICAS 
							FROM PRODUCT_THERAP_ACTIONS PTA 
							INNER JOIN THERAPEUTIC_ACTIONS D ON D.THERAPEUTIC_ACTION_ID = PTA.THERAPEUTIC_ACTION_ID
							WHERE PTA.PRODUCT_ID = '${stock.id}'">
					<field column="ACCIONES_TERAPEUTICAS" name="ACCIONES_TERAPEUTICAS" />
			</entity>

		</entity>

	</document>

</dataConfig>
